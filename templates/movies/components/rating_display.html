<div class="bg-dark-gray rounded-lg p-6" id="rating-section">
    <div class="mb-6">
        <h3 class="text-lg font-semibold mb-3">Calificación</h3>
        <div class="flex items-center gap-4">
            <div class="flex items-baseline">
                <span class="text-4xl font-bold text-white">
                    {{ calificacion_promedio|floatformat:1 }}
                </span>
                <span class="text-xl text-gray-400 ml-1">/5.0</span>
            </div>
            <div>
                <div class="flex gap-1 mb-1">
                    {% for i in "12345" %}
                        <svg class="w-6 h-6 {% if forloop.counter <= calificacion_promedio %}text-yellow-400{% else %}text-gray-500{% endif %}" 
                             fill="currentColor" 
                             viewBox="0 0 20 20"
                             aria-hidden="true">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                    {% endfor %}
                </div>
                <p class="text-sm text-gray-400">
                    Basado en {{ total_calificaciones }} calificación{{ total_calificaciones|pluralize:"es" }}
                </p>
            </div>
        </div>
    </div>
    
    {% if user.is_authenticated %}
        <div class="border-t border-gray-700 pt-6">
            <h4 class="font-semibold mb-3">
                {% if rating_usuario %}Tu calificación: {{ rating_usuario.puntuacion }}⭐{% else %}Califica esta película{% endif %}
            </h4>
            
            <form hx-post="{% url 'movies:rate_movie' pelicula.id %}"
                  hx-target="#rating-section"
                  hx-swap="outerHTML"
                  class="space-y-4"
                  id="rating-form">
                
                <div>
                    <fieldset>
                        <legend class="block text-sm mb-3">Selecciona tu puntuación</legend>
                        <div class="flex gap-2" id="star-rating" role="radiogroup" aria-label="Selecciona tu calificación">
                            {% for i in "12345" %}
                                <label class="star-label cursor-pointer">
                                    <input type="radio" 
                                           name="puntuacion" 
                                           value="{{ forloop.counter }}" 
                                           class="star-input sr-only"
                                           {% if rating_usuario.puntuacion == forloop.counter %}checked{% endif %}
                                           required
                                           aria-label="{{ forloop.counter }} estrella{{ forloop.counter|pluralize:"s" }}">
                                    <span class="sr-only">{{ forloop.counter }} estrella{{ forloop.counter|pluralize:"s" }}</span>
                                    <svg class="w-10 h-10 star-icon text-gray-500 transition-colors duration-150" 
                                         fill="currentColor" 
                                         viewBox="0 0 20 20"
                                         aria-hidden="true">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                    </svg>
                                </label>
                            {% endfor %}
                        </div>
                    </fieldset>
                </div>
                
                <button type="submit" 
                        class="w-full bg-hbo-blue hover:bg-blue-700 px-6 py-3 rounded-lg font-bold transition focus:outline-none focus:ring-2 focus:ring-blue-500">
                    {% if rating_usuario %}Actualizar calificación{% else %}Publicar calificación{% endif %}
                </button>
            </form>
        </div>
    {% else %}
        <div class="border-t border-gray-700 pt-6 text-center text-gray-400">
            <a href="{% url 'movies:login' %}" class="text-white hover:text-hbo-blue hover:underline transition-colors">
                Inicia sesión
            </a> para calificar esta película
        </div>
    {% endif %}
</div>